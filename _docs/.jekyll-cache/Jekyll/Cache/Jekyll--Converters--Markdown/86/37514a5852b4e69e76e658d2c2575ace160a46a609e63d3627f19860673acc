I"›<!-- Breadcrumb navigation -->
<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="https://autoit-gui-skeleton.github.io//fr/">Home</a></li>
    <li class="breadcrumb-item"><a href="https://autoit-gui-skeleton.github.io//fr/documentation">Documentation</a></li>
    <li class="breadcrumb-item active" aria-current="page">Cr√©ation d'installeur Windows pour des applications AutoIt</li>
  </ol>
</nav>

<!-- To be placed at the beginning of the post, it is where the table of content will be generated -->
<ul id="markdown-toc">
  <li><a href="#objectifs-et-motivations" id="markdown-toc-objectifs-et-motivations">Objectifs et motivations</a></li>
  <li><a href="#packager-une-application-autoit-et-cr√©er-un-programme-dinstallation-windows" id="markdown-toc-packager-une-application-autoit-et-cr√©er-un-programme-dinstallation-windows">Packager une application AutoIt et cr√©er un programme d‚Äôinstallation Windows</a>    <ul>
      <li><a href="#utiliser-un-batch-windows-pour-contr√¥ler-la-g√©n√©ration-de-linstalleur" id="markdown-toc-utiliser-un-batch-windows-pour-contr√¥ler-la-g√©n√©ration-de-linstalleur">Utiliser un batch Windows pour contr√¥ler la g√©n√©ration de l‚Äôinstalleur</a>        <ul>
          <li><a href="#√©tape-17--cr√©er-un-r√©pertoire-de-sortie" id="markdown-toc-√©tape-17--cr√©er-un-r√©pertoire-de-sortie">√âtape 1/7 : cr√©er un r√©pertoire de sortie</a></li>
          <li><a href="#√©tape-27-compilation-autoit-du-programme-principal" id="markdown-toc-√©tape-27-compilation-autoit-du-programme-principal">√âtape 2/7: Compilation AutoIt du programme principal</a></li>
          <li><a href="#√©tape-37-copier-les-ressources" id="markdown-toc-√©tape-37-copier-les-ressources">√âtape 3/7: Copier les ressources</a></li>
          <li><a href="#√©tape-47-cr√©ation-dun-fichier-avec-des-m√©tadonn√©es-sur-la-g√©n√©ration" id="markdown-toc-√©tape-47-cr√©ation-dun-fichier-avec-des-m√©tadonn√©es-sur-la-g√©n√©ration">√âtape 4/7: Cr√©ation d‚Äôun fichier avec des m√©tadonn√©es sur la g√©n√©ration</a></li>
          <li><a href="#√©tape-57-cr√©er-larchive-zip" id="markdown-toc-√©tape-57-cr√©er-larchive-zip">√âtape 5/7: Cr√©er l‚Äôarchive zip</a></li>
          <li><a href="#√©tape-67-cr√©er-linstalleur-windows-avec-le-script-innosetup" id="markdown-toc-√©tape-67-cr√©er-linstalleur-windows-avec-le-script-innosetup">√âtape 6/7: Cr√©er l‚Äôinstalleur Windows avec le script InnoSetup</a></li>
          <li><a href="#√©tape-77-nettoyer-en-supprimant-le-r√©pertoire-temporaire" id="markdown-toc-√©tape-77-nettoyer-en-supprimant-le-r√©pertoire-temporaire">√âtape 7/7: Nettoyer en supprimant le r√©pertoire temporaire</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#fonctionnalit√©-dun-installeur-windows-avec-ags-et-innosetup" id="markdown-toc-fonctionnalit√©-dun-installeur-windows-avec-ags-et-innosetup">Fonctionnalit√© d‚Äôun installeur Windows avec AGS et InnoSetup</a>    <ul>
      <li><a href="#support-de-linternationalisation-i18n" id="markdown-toc-support-de-linternationalisation-i18n">Support de l‚Äôinternationalisation (i18n)</a></li>
      <li><a href="#v√©rifier-si-lapplication-est-d√©j√†-install√©e-sur-le-pc" id="markdown-toc-v√©rifier-si-lapplication-est-d√©j√†-install√©e-sur-le-pc">V√©rifier si l‚Äôapplication est d√©j√† install√©e sur le PC</a></li>
      <li><a href="#configurer-des-messages-suppl√©mentaires-dans-linstalleur--licence-pr√©requis--historique" id="markdown-toc-configurer-des-messages-suppl√©mentaires-dans-linstalleur--licence-pr√©requis--historique">Configurer des messages suppl√©mentaires dans l‚Äôinstalleur : licence, pr√©requis &amp; historique</a></li>
      <li><a href="#ajouter-des-ic√¥nes-dans-le-menu-d√©marrer-de-windows" id="markdown-toc-ajouter-des-ic√¥nes-dans-le-menu-d√©marrer-de-windows">Ajouter des ic√¥nes dans le menu D√©marrer de Windows</a></li>
      <li><a href="#√©xecuter-une-commande-apr√®s-linstallation" id="markdown-toc-√©xecuter-une-commande-apr√®s-linstallation">√âxecuter une commande apr√®s l‚Äôinstallation</a></li>
      <li><a href="#personnaliser-et-modifiez-les-√©l√©ments-graphiques-du-programme-dinstallation-windows" id="markdown-toc-personnaliser-et-modifiez-les-√©l√©ments-graphiques-du-programme-dinstallation-windows">Personnaliser et modifiez les √©l√©ments graphiques du programme d‚Äôinstallation Windows</a></li>
    </ul>
  </li>
  <li><a href="#code-source" id="markdown-toc-code-source">Code source</a>    <ul>
      <li><a href="#windows-batch" id="markdown-toc-windows-batch">Windows batch</a></li>
      <li><a href="#innosetup-script-iss-associ√©" id="markdown-toc-innosetup-script-iss-associ√©">InnoSetup Script (ISS) associ√©</a></li>
    </ul>
  </li>
</ul>

<h1 id="objectifs-et-motivations">Objectifs et motivations</h1>

<p>Lorsqu‚Äôon termine une application, et que nous avons un binaire ex√©cutable, il faut trouver un moyen pour faciliter son d√©ploiement et son installation sur un poste client. L‚Äôapproche naturelle est de cr√©er une simple archive zip du projet. Mais ce n‚Äôest pas suffisant, si on souhaite b√©n√©ficier de toutes les fonctionnalit√©s d‚Äôun installeur Windows.</p>

<p>Ainsi afin de faciliter le d√©ploiement d‚Äôune application de bureau Windows, AGS propose de construire un installeur Windows via la solution <a href="http://www.jrsoftware.org/isinfo.php">InnoSetup</a>.</p>

<h1 id="packager-une-application-autoit-et-cr√©er-un-programme-dinstallation-windows">Packager une application AutoIt et cr√©er un programme d‚Äôinstallation Windows</h1>

<p>Pour pr√©parer un package et g√©n√©rer un programme d‚Äôinstallation, les principales √©tapes √† suivre sont les suivantes :</p>

<p>¬† - Affecter un num√©ro de version √† l‚Äôapplication et configurez les scripts qui cr√©ent le paquet et g√©n√®rent le programme d‚Äôinstallation de Windows.
¬† - Compiler l‚Äôapplication via le point d‚Äôentr√©e principal myApplication.au3 avec le compilateur theaut2exe;
¬† - Copier les assets (images, fichiers ‚Ä¶) n√©cessaires au bon fonctionnement de l‚Äôapplication dans le r√©pertoire de sortie;
¬† - Cr√©er une archive zip pour r√©cup√©rer l‚Äôapplication;
¬† - Et finalement construire le programme d‚Äôinstallation en compilant le script InnoSetup associ√©.</p>

<p>Toutes les √©tapes, pour packager l‚Äôapplication et g√©n√©rer le programme d‚Äôinstallation, sont pilot√©es √† partir d‚Äôun batch Windows, pour des raisons √©videntes de re-jouabilit√© et de facilit√© d‚Äôutilisation.</p>

<h2 id="utiliser-un-batch-windows-pour-contr√¥ler-la-g√©n√©ration-de-linstalleur">Utiliser un batch Windows pour contr√¥ler la g√©n√©ration de l‚Äôinstalleur</h2>

<p>Avec AGS nous utilisons un fichier batch Windows, appel√© <code class="language-plaintext highlighter-rouge">AGS-deployment-setup.bat</code>, qui pilote la g√©n√©ration de l‚Äôinstalleur Windows. Il va cr√©er le r√©pertoire de sortie <code class="language-plaintext highlighter-rouge">\releases\vx.y.z\</code>, dans lequel l‚Äôarchive zip de l‚Äôapplication et le programme d‚Äôinstallation de Windows seront construits.</p>

<p><img src="https://autoit-gui-skeleton.github.io//assets/img/documentation/AGS-package-and-deployment-process.gif" alt="AGS GUI package and deployment process" class="img-full img-fancybox" /></p>

<p><br /></p>

<p>Pour ce faire, il suivra les 7 √©tapes suivantes:</p>

<h3 id="√©tape-17--cr√©er-un-r√©pertoire-de-sortie">√âtape 1/7 : cr√©er un r√©pertoire de sortie</h3>

<p>Avant l‚Äôex√©cution du batch Windows, il est n√©cessaire de d√©finir diff√©rentes variables utilis√©es dans ce processus de cr√©ation d‚Äôinstalleur:</p>

<table>
  <thead>
    <tr>
      <th>Variable</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">%VERSION%</code></td>
      <td>Version assigned to the application.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">%NAME_PROJECT%</code></td>
      <td>Used to name the executable of the application. Note that the version number also appears in the executable name.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">%AUT2EXE_AU3%</code></td>
      <td>The name of the main AutoIt file (<code class="language-plaintext highlighter-rouge">myApplication.au3</code>)</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">%AUT2EXE_ICON%</code></td>
      <td>The application icon (<code class="language-plaintext highlighter-rouge">%FOLDER_SRC%\assets\images\myApplication.ico</code>)</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">%ZIP_CLI%</code></td>
      <td>Path of the 7zip binary to create an archive (<code class="language-plaintext highlighter-rouge">"C:\Program Files\7-Zip\7z.exe"</code>). I advise you to install it via the manager Chocolatey.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">%ISCC_CLI%</code></td>
      <td>InnoSetup compiler binary path (<code class="language-plaintext highlighter-rouge">"C:\Program Files (x86)\Inno Setup 5\ISCC.exe "</code>). I advise you to install it via the manager Chocolatey.</td>
    </tr>
  </tbody>
</table>

<p>√Ä partir de ces variables, le batch Windows construira le r√©pertoire de sortie <code class="language-plaintext highlighter-rouge">.\ Releases\v1.0.0\ myApplication_v1.0.0\</code>, dans lequel le programme d‚Äôentr√©e principal sera compiler,</p>

<h3 id="√©tape-27-compilation-autoit-du-programme-principal">√âtape 2/7: Compilation AutoIt du programme principal</h3>

<p>Le programme AutoIt principal est compil√© en ligne de commande avec le binaire <code class="language-plaintext highlighter-rouge">aut2exe</code>. Attention, il faut que ce dernier soit correctement renseign√© dans la variable d‚Äôenvironnement <code class="language-plaintext highlighter-rouge">%PATH%</code> du syst√®me d‚Äôexploitation.</p>

<pre><code class="language-Batch">:: deployment_autoit_application.bat ::

(...)

set AUT2EXE_ARGS=/in "%FOLDER_SRC%\%AUT2EXE_AU3%" /out "%FOLDER_OUT%\%NAME_EXE%" /icon
aut2exe %AUT2EXE_ARGS%
echo Compilation AutoIt is finished.
</code></pre>

<h3 id="√©tape-37-copier-les-ressources">√âtape 3/7: Copier les ressources</h3>

<p>Lorsque le processus est lanc√©, il copiera dans le r√©pertoire de sortie tous les √©l√©ments (images, fichiers ‚Ä¶) n√©cessaires au bon fonctionnement de l‚Äôapplication et √† la g√©n√©ration du programme d‚Äôinstallation dans le r√©pertoire de sortie.</p>

<h3 id="√©tape-47-cr√©ation-dun-fichier-avec-des-m√©tadonn√©es-sur-la-g√©n√©ration">√âtape 4/7: Cr√©ation d‚Äôun fichier avec des m√©tadonn√©es sur la g√©n√©ration</h3>

<p>Dans le but de garder la date de g√©n√©ration, le batch va cr√©er un fichier <code class="language-plaintext highlighter-rouge">".v%VERSION%"</code> dans le r√©pertoire de sortie. Il est possible ainsi de stocker dans ce fichier texte d‚Äôautres m√©tadonn√©es dont a besoin pour d√©crire l‚Äôapplication et son installeur.</p>

<h3 id="√©tape-57-cr√©er-larchive-zip">√âtape 5/7: Cr√©er l‚Äôarchive zip</h3>

<p>La cr√©ation de l‚Äôarchive zip n√©cessite que 7zip soit install√© sur l‚Äôordinateur et que la variable <code class="language-plaintext highlighter-rouge">%ZIP_CLI%</code> soit correctement renseign√©e avec le chemin complet de ce binaire. La commande qui g√©n√®re alors l‚Äôarchive est la suivante:</p>

<pre><code class="language-Batch">set ZIP_CLI="C:\Program Files\7-Zip\7z.exe"

%ZIP_CLI% a -tzip %NAME_PROJECT%_v%VERSION%.zip "%NAME_PROJECT%_v%VERSION%
echo * The zip has been created.
</code></pre>

<h3 id="√©tape-67-cr√©er-linstalleur-windows-avec-le-script-innosetup">√âtape 6/7: Cr√©er l‚Äôinstalleur Windows avec le script InnoSetup</h3>

<p>Le script InnoSetup <code class="language-plaintext highlighter-rouge">.\Deployment\deployment_autoit_application.iss</code> contient toutes les instructions pour g√©n√©rer le programme d‚Äôinstallation Windows associ√©.</p>

<p>On passe les arguments d√©finis dans le batch Windows au script ISS via l‚Äôinstruction <code class="language-plaintext highlighter-rouge">/dNameVariable=ValueVariable</code> en ligne de commande. Ainsi avec cette d√©marche, il suffit de configurer une seule fois les variables du projet (nom, version ‚Ä¶) dans le fichier batch Windows. Il n‚Äôest pas n√©cessaire de reconfigurer les variables dans le script ISS.</p>

<blockquote>
  <p><strong>!!! Attention !!!</strong></p>

  <p>Dans le fichier de script ISS, il existe d‚Äôautres variables √† configurer: <code class="language-plaintext highlighter-rouge">ApplicationPublisher</code>,<code class="language-plaintext highlighter-rouge"> ApplicationURL</code>, <code class="language-plaintext highlighter-rouge">ApplicationGUID</code>, ‚Ä¶</p>
</blockquote>

<pre><code class="language-Batch">set ISCC_CLI="C:\Program Files (x86)\Inno Setup 5\ISCC.exe"
set ISCC_SCRIPT=deployment_autoit_application.iss

echo * Launch compilation with iscc
%ISCC_CLI% %ISCC_SCRIPT% /dApplicationVersion=%VERSION% /dApplicationName=%NAME_PROJECT%
echo * Compilation has been finished.
</code></pre>

<h3 id="√©tape-77-nettoyer-en-supprimant-le-r√©pertoire-temporaire">√âtape 7/7: Nettoyer en supprimant le r√©pertoire temporaire</h3>

<p>Il suffit de conserver uniquement l‚Äôarchive Zip et le programme d‚Äôinstallation Windows √† la fin du processus. Donc le batch Windows supprime le r√©pertoire temporaire √† la fin du processus.</p>

<p><img src="https://autoit-gui-skeleton.github.io//assets/img/documentation/AGS-package-and-deployment-result.png" alt="AGS GUI package and deployment result" class="img-full" /></p>

<h1 id="fonctionnalit√©-dun-installeur-windows-avec-ags-et-innosetup">Fonctionnalit√© d‚Äôun installeur Windows avec AGS et InnoSetup</h1>

<h2 id="support-de-linternationalisation-i18n">Support de l‚Äôinternationalisation (i18n)</h2>

<p>Pour ajouter une nouvelle langue, il suffit d‚Äôajouter dans la section <code class="language-plaintext highlighter-rouge">[languages]</code> la langue fournie dans le compilateur dans le fichier de script InnoSetup (ISS). Cela va traduire tous les messages natifs √† InnoSetup.
Attention, m√©fiez-vous des boutons ¬´YES/NO¬ª des MsgBox. Ils n‚Äôutilisent que la langue du syst√®me d‚Äôexploitation.</p>

<pre><code class="language-Batch">[Languages]
Name: "en"; MessagesFile: compiler:Default.isl;
Name: "french"; MessagesFile: "compiler:Languages\French.isl"
</code></pre>

<p>Pour traduire les autres messages, il suffit de les d√©clarer dans la section <code class="language-plaintext highlighter-rouge">[CustomMessages]</code>, en pr√©fixant les variables avec la langue (<code class="language-plaintext highlighter-rouge">en</code>,<code class="language-plaintext highlighter-rouge"> french</code>, <code class="language-plaintext highlighter-rouge">nl</code>, ‚Ä¶). <a href="http://www.jrsoftware.org/ishelp/index.php?topic=languagessection">http://www.jrsoftware.org/ishelp/index.php?topic=languagessection</a></p>

<pre><code class="language-Batch">[CustomMessages]
french.CheckInstall=est d√©j√† install√© sur ce PC.
french.CheckInstallAction=Souhaitez-vous d√©sinstaller cette version existante avant de poursuivre?
en.CheckInstall=is already install on this PC.
en.CheckInstallAction=Do you want to uninstall this existing version before continuing?
</code></pre>

<p>Ainsi, au d√©marrage de l‚Äôinstallation, il demande √† l‚Äôutilisateur de choisir la langue qu‚Äôil doit utiliser.</p>

<p><img src="https://autoit-gui-skeleton.github.io//assets/img/documentation/innosetup_choose_language.png" alt="AGS InnoSetup choix langue" /></p>

<h2 id="v√©rifier-si-lapplication-est-d√©j√†-install√©e-sur-le-pc">V√©rifier si l‚Äôapplication est d√©j√† install√©e sur le PC</h2>

<p>Pour √©viter d‚Äôinstaller plusieurs fois l‚Äôapplication sur l‚Äôordinateur client, le programme d‚Äôinstallation v√©rifie √† l‚Äôavance qu‚Äôil n‚Äôest pas d√©j√† pr√©sent.</p>

<p><img src="https://autoit-gui-skeleton.github.io//assets/img/documentation/innosetup_check_already_install.png" alt="AGS InnoSetup check already install" /></p>

<p>Pour ce faire, il est bas√© sur le GUID (<em>global unique identifier</em>) d√©fini dans le script InnoSetup. Il est important de ne pas modifier ce code entre diff√©rentes versions d‚Äôapplication et qu‚Äôil soit unique par application. L‚ÄôIDE fourni par InnoSetup fournit un outil pour en g√©n√©rer un nouveau GUID, accessible via le menu: <em>Outils &gt; G√©n√©rer GUID dans l‚ÄôIDE</em>.</p>

<pre><code class="language-Batch">; NOTE: The value of AppId uniquely identifies this application.
; Do not use the same AppId value in installers for other applications.
; (To generate a new GUID, click Tools | Generate GUID inside the IDE.)
#define ApplicationGUID "6886E28B-AAB5-4866-BCD5-E1B4C171A87A"
#define ApplicationID ApplicationName + "_" + ApplicationGUID
</code></pre>

<p>Le programme d‚Äôinstallation ajoute la cl√© <code class="language-plaintext highlighter-rouge">SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\{# ApplicationID}_is1</code> dans la base de registre Windows. Et lorsque l‚Äôapplication est d√©sinstall√©e, cette cl√© est supprim√©e. Il suffit donc de v√©rifier la pr√©sence de cette cl√© dans le registre pour savoir si l‚Äôapplication a d√©j√† √©t√© install√©e.</p>

<p><img src="https://autoit-gui-skeleton.github.io//assets/img/documentation/innosetup_check_already_install2.png" alt="AGS InnoSetup check already install in Windows registry" class="img-fancybox img-full" /></p>

<h2 id="configurer-des-messages-suppl√©mentaires-dans-linstalleur--licence-pr√©requis--historique">Configurer des messages suppl√©mentaires dans l‚Äôinstalleur : licence, pr√©requis &amp; historique</h2>

<p>Pour configurer diff√©rents messages pour le programme d‚Äôinstallation, y compris les accords de licence, il suffit de remplir les fichiers texte stock√©s dans le r√©pertoire <code class="language-plaintext highlighter-rouge">/Assets</code>.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">AFTER_INSTALL.txt</code>: g√©n√©ralement pour afficher la feuille de route et l‚Äôhistorique du projet;</li>
  <li><code class="language-plaintext highlighter-rouge">BEFORE_INSTALL.txt</code>: g√©n√©ralement pour afficher les pr√©requis de l‚Äôapplication;</li>
  <li><code class="language-plaintext highlighter-rouge">LICENSE.txt</code>: pour la licence d‚Äôutilisation.</li>
</ul>

<p><img src="https://autoit-gui-skeleton.github.io//assets/img/documentation/innosetup_choose_license_agreement.png" alt="AGS InnoSetup licence aggrement" /></p>

<h2 id="ajouter-des-ic√¥nes-dans-le-menu-d√©marrer-de-windows">Ajouter des ic√¥nes dans le menu D√©marrer de Windows</h2>

<p>Pour ajouter des √©l√©ments au menu D√©marrer de Windows, entrez la section <code class="language-plaintext highlighter-rouge">[Icons]</code> dans le script InnoSetup comme suit:</p>

<div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span><span class="kd">Icons</span><span class="o">]</span>
<span class="kd">Name</span>: <span class="s2">"{group}\{#ApplicationName}"</span><span class="o">;</span> <span class="kd">Filename</span>: <span class="s2">"{app}\{#ApplicationExeName}"</span><span class="o">;</span> <span class="kd">IconFilename</span>: <span class="o">{</span><span class="kd">app</span><span class="o">}</span>\assets\images\myApplication.ico<span class="o">;</span>
<span class="kd">Name</span>: <span class="s2">"{group}\{cm:ProgramOnTheWeb,{#ApplicationName}}"</span><span class="o">;</span> <span class="kd">Filename</span>: <span class="s2">"{#ApplicationURL}"</span><span class="o">;</span>
<span class="kd">Name</span>: <span class="s2">"{group}\{cm:UninstallProgram,{#ApplicationName}}"</span><span class="o">;</span> <span class="kd">Filename</span>: <span class="s2">"{uninstallexe}"</span><span class="o">;</span> <span class="kd">IconFilename</span>: <span class="o">{</span><span class="kd">app</span><span class="o">}</span>\assets\images\setup.ico<span class="o">;</span>
<span class="kd">Name</span>: <span class="s2">"{commondesktop}\{#ApplicationName}"</span><span class="o">;</span> <span class="kd">Filename</span>: <span class="s2">"{app}\{#ApplicationExeName}"</span><span class="o">;</span> <span class="kd">IconFilename</span>: <span class="o">{</span><span class="kd">app</span><span class="o">}</span>\assets\images\myApplication.ico<span class="o">;</span> <span class="kd">IconIndex</span>: <span class="m">0</span>
</code></pre></div></div>

<p>Ainsi on obtient :</p>

<p><img src="https://autoit-gui-skeleton.github.io//assets/img/documentation/innosetup_finish2.png" alt="AGS InnoSetup licence Windows icons start menu" /></p>

<h2 id="√©xecuter-une-commande-apr√®s-linstallation">√âxecuter une commande apr√®s l‚Äôinstallation</h2>

<p>Il est possible de configurer l‚Äôinstalleur pour qu‚Äôil √©xecute une commande √† la fin de l‚Äôinstallation, comme par exemple pour d√©marrer l‚Äôapplication, ouvrir une page web, ouvrir un pdf‚Ä¶</p>

<p><img src="https://autoit-gui-skeleton.github.io//assets/img/documentation/innosetup_finish.png" alt="AGS InnoSetup licence Windows icons start menu" /></p>

<h2 id="personnaliser-et-modifiez-les-√©l√©ments-graphiques-du-programme-dinstallation-windows">Personnaliser et modifiez les √©l√©ments graphiques du programme d‚Äôinstallation Windows</h2>

<p>Nous avons choisi une taille (largeur ; hauteur) statique pour le setup Windows. Ce n‚Äôest pas le plus facile de changer ces dimensions, mais c‚Äôest possible.</p>

<p>Il y a 2 images et 2 ic√¥nes utilis√©es dans le setup. Ils sont stock√©s dans le r√©pertoire <code class="language-plaintext highlighter-rouge">.\Assets\images</code>. Attention avec InnoSetup, les images sont n√©cessairement au format bmp. De plus elles doivent respecter les tailles standards, pour ne pas √™tre d√©form√©.</p>

<table>
  <thead>
    <tr>
      <th>Images use in setup</th>
      <th>File</th>
      <th>Comments</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>UninstallDisplayIcon</td>
      <td>.\assets\images\myApplication.ico</td>
      <td>Must be an ico</td>
    </tr>
    <tr>
      <td>SetupIconFile</td>
      <td>.\assets\images\setup.ico</td>
      <td>Must be an ico</td>
    </tr>
    <tr>
      <td>WizardImageFile</td>
      <td>.\assets\images\innosetup_background.bmp</td>
      <td>Must be a 500x313 bmp image</td>
    </tr>
    <tr>
      <td>WizardSmallImageFile</td>
      <td>.\assets\images\innosetup_image.bmp</td>
      <td>Must be a 50x50 bmp image</td>
    </tr>
  </tbody>
</table>

<p>Dans le script InnoSetup, ils sont utilis√©s comme suit:</p>

<pre><code class="language-Batch">UninstallDisplayIcon={app}\assets\images\myApplication.ico
WizardImageFile={#PathAssets}\images\innosetup_background.bmp
WizardSmallImageFile={#PathAssets}\images\innosetup_image.bmp
SetupIconFile={#PathAssets}\images\setup.ico
</code></pre>

<h1 id="code-source">Code source</h1>

<h2 id="windows-batch">Windows batch</h2>

<pre><code class="language-Batch">::------------------------------------------------------------------------------
::
::    Copyright ¬© 2018-05
::
::    @name           : AGS-deployment-setup
::    @version        : 1.0.1
::    @AGS package    : AGS v1.0.0
::    @AutoIt version : v3.3.14.5
::    @authors        : 20100 &lt;vb20100bv@gmail.com&gt;
::
::------------------------------------------------------------------------------


cls
@echo off

:: Change value for this variables
set VERSION=0.9.0
set NAME_PROJECT=ApplicationWithCheckForUpdates

:: Deployment variables
set FOLDER_CURRENT=%cd%
set NAME_EXE=%NAME_PROJECT%_v%VERSION%.exe
set FOLDER_SRC=%FOLDER_CURRENT%\..\
cd %FOLDER_SRC%
set FOLDER_SRC=%cd%
set FOLDER_OUT=%FOLDER_CURRENT%\v%VERSION%\%NAME_PROJECT%_v%VERSION%

:: AutoIt compiler
Set AUT2EXE_AU3=ApplicationWithCheckForUpdates.au3
set AUT2EXE_ICON=%FOLDER_SRC%\assets\images\myApplication.ico
set AUT2EXE_ARGS=/in "%FOLDER_SRC%\%AUT2EXE_AU3%" /out "%FOLDER_OUT%\%NAME_EXE%" /icon "%AUT2EXE_ICON%"

:: Path binaries
set ZIP_CLI="C:\Program Files\7-Zip\7z.exe"
set ISCC_CLI="C:\Program Files (x86)\Inno Setup 5\ISCC.exe"
set ISCC_SCRIPT=AGS-deployment-setup.iss


echo.
echo.
echo      [  AGS-deployment-setup  ]
echo.     
echo.


echo ----[ Variables for generation ]----
echo * VERSION        = %VERSION%
echo * NAME_PROJECT   = %NAME_PROJECT%
echo * FOLDER_CURRENT = %FOLDER_CURRENT%
echo * NAME_EXE       = %NAME_EXE%
echo * FOLDER_SRC     = %FOLDER_SRC%
echo * FOLDER_OUT     = %FOLDER_OUT%
echo * AUT2EXE_ICON   = %AUT2EXE_ICON%
echo * AUT2EXE_AU3    = %AUT2EXE_AU3%
echo * AUT2EXE_ARGS   = %AUT2EXE_ARGS%
echo * ZIP_CLI        = %ZIP_CLI%
echo * ISCC_CLI       = %ISCC_CLI%
echo * ISCC_SCRIPT    = %ISCC_SCRIPT%
echo -------------------------------------

echo.
echo.

echo ----[ Step 1/7 - Creating directories ]----
cd %FOLDER_CURRENT%
echo * Attempt to create : "%cd%\v%VERSION%\"
mkdir v%VERSION%
cd v%VERSION%
echo.
echo * Attempt to create : %cd%\%NAME_PROJECT%_v%VERSION%\
mkdir %NAME_PROJECT%_v%VERSION%
cd %FOLDER_CURRENT%
echo -------------------------------------

echo.
echo.


echo ----[ Step 2/7 - Launch AutoIt compilation ]----
echo * Run compilation with aut2exe and AUT2EXE_ARGS.
aut2exe %AUT2EXE_ARGS%
echo * Compilation AutoIt is finished.
echo -------------------------------------

echo.
echo.


echo ----[ Step 3/7 - Copy assets files ]----
echo * Create the file xcopy_EXCLUDE.txt in order to ignore some file and directory.
echo .au3 &gt; xcopy_Exclude.txt
echo /releases/ &gt;&gt; xcopy_Exclude.txt
echo /src/ &gt;&gt; xcopy_Exclude.txt
echo /vendor/ &gt;&gt; xcopy_Exclude.txt
echo *   - ignore all .au3 files
echo *   - ignore all .pspimage files
echo * The file xcopy_EXCLUDE.txt is created.
echo.
echo * Copy additional files store in assets, config, docs directories
xcopy "%FOLDER_SRC%\assets" "%FOLDER_OUT%\assets\" /E /H /Y /EXCLUDE:xcopy_Exclude.txt
xcopy "%FOLDER_SRC%\config" "%FOLDER_OUT%\config\" /E /H /Y /EXCLUDE:xcopy_Exclude.txt
xcopy "%FOLDER_SRC%\docs" "%FOLDER_OUT%\docs\" /E /H /Y /EXCLUDE:xcopy_Exclude.txt
@copy "%FOLDER_SRC%\package.json" "%FOLDER_OUT%\package.json" /Y &gt; log
echo "%FOLDER_SRC%\package.json" is copied.
@copy "%FOLDER_SRC%\README.md" "%FOLDER_OUT%\README.md" /Y &gt; log
echo "%FOLDER_SRC%\README.md" is copied.
echo * Ok all files and directory are copied.
echo.
echo * Delete xcopy_Exclude.txt.
del xcopy_Exclude.txt
del log
echo -------------------------------------

echo.
echo.


echo ----[ Step 4/7 - Create additional files ]----
echo * Create file ".v%VERSION%" in FOLDER_OUT.
cd %FOLDER_OUT%
echo Last compilation of application %NAME_PROJECT% version %VERSION% the %date% at %time% &gt; .v%VERSION%
echo * This file has been created.
echo -------------------------------------

echo.
echo.


echo ----[ Step 5/7 - Create zip archive ]----
echo * Move in the folder %FOLDER_CURRENT%\v%VERSION%
cd %FOLDER_CURRENT%\v%VERSION%
echo * Zip the folder %NAME_PROJECT%_v%VERSION%
%ZIP_CLI% a -tzip %NAME_PROJECT%_v%VERSION%.zip "%NAME_PROJECT%_v%VERSION%
echo * The zip has been created.
echo -------------------------------------

echo.
echo.

echo ----[ Step 6/7 - Make setup with InnoSetup command line compilation ]----
cd %FOLDER_CURRENT%
echo * Launch compilation with iscc
%ISCC_CLI% %ISCC_SCRIPT% /dApplicationVersion=%VERSION% /dApplicationName=%NAME_PROJECT%
echo.
echo * Compilation has been finished.
echo -------------------------------------

echo.
echo.

echo ----[ Step 7/7 - Delete temp folder use for ISS compilation ]----
cd %FOLDER_CURRENT%
echo * Delete the folder %FOLDER_CURRENT%\v%VERSION%\%NAME_PROJECT%_v%VERSION%\
rmdir %FOLDER_CURRENT%\v%VERSION%\%NAME_PROJECT%_v%VERSION% /S /Q
echo -------------------------------------

echo.
echo.

cd %FOLDER_CURRENT%
echo ----[ End process ]----
echo.
</code></pre>

<h2 id="innosetup-script-iss-associ√©">InnoSetup Script (ISS) associ√©</h2>

<div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">;---------------------------------------------------------------------------------</span>
<span class="o">;</span>
<span class="o">;</span>    <span class="kd">Copyright</span> ¬© <span class="m">2018</span><span class="o">-</span><span class="m">05</span><span class="o">,</span> <span class="kd">v20100v</span>
<span class="o">;</span>
<span class="o">;</span>    @author    <span class="kd">v20100v</span>
<span class="o">;</span>    @contact   <span class="m">7567933</span><span class="na">+v</span><span class="m">20100</span><span class="kd">v</span>@users.noreply.github.com
<span class="o">;</span>    @version   <span class="m">1</span>.0.0
<span class="o">;</span>
<span class="o">;---------------------------------------------------------------------------------</span>

<span class="o">;</span> <span class="kd">ApplicationVersion</span> : <span class="kd">the</span> <span class="kd">version</span> <span class="kd">number</span> <span class="kd">is</span> <span class="ow">defined</span> <span class="kd">by</span> <span class="kd">InnoSetupCommandLineCompiler</span> <span class="o">(</span><span class="kd">iscc</span><span class="o">)</span> <span class="kd">with</span> <span class="na">/d</span><span class="o">&lt;</span><span class="kd">name</span><span class="o">&gt;[=&lt;</span><span class="kd">value</span><span class="o">&gt;]</span>	<span class="o">(</span><span class="na">/dApplicationVersion</span><span class="o">=</span><span class="m">0</span>.3.6.5<span class="o">)</span>
<span class="o">;</span> <span class="kd">ApplicationName</span> : <span class="kd">the</span> <span class="kd">name</span> <span class="kd">of</span> <span class="kd">applciation</span> <span class="kd">is</span> <span class="ow">defined</span> <span class="kd">by</span> <span class="kd">InnoSetupCommandLineCompiler</span> <span class="o">(</span><span class="kd">iscc</span><span class="o">)</span> <span class="kd">with</span> <span class="na">/d</span><span class="o">&lt;</span><span class="kd">name</span><span class="o">&gt;[=&lt;</span><span class="kd">value</span><span class="o">&gt;]</span>	<span class="o">(</span><span class="na">/dApplicationName</span><span class="o">=</span><span class="kd">MyApplication</span><span class="o">)</span>

#define <span class="kd">ApplicationPublisher</span> <span class="s2">"v20100v"</span>
#define <span class="kd">ApplicationURL</span> <span class="s2">"https://github.com/v20100v/autoit-gui-skeleton"</span>
#define <span class="kd">ApplicationExeName</span> <span class="kd">ApplicationName</span><span class="o">+</span><span class="s2">"_v"</span> <span class="o">+</span> <span class="kd">ApplicationVersion</span> <span class="o">+</span> <span class="s2">".exe"</span>
#define <span class="kd">ApplicationCopyright</span> <span class="s2">"Copyright (C) 2018, A.C.M.E v20100v"</span>

<span class="o">;</span> <span class="kd">Get</span> <span class="kd">the</span> <span class="nb">path</span> <span class="nb">where</span> <span class="kd">the</span> <span class="kd">script</span> <span class="kd">iss</span> <span class="kd">is</span> <span class="kd">placed</span>
#define <span class="kd">PathRelease</span> <span class="kd">SourcePath</span> <span class="o">+</span> <span class="s2">"releases\v"</span> <span class="o">+</span> <span class="kd">ApplicationVersion</span> <span class="o">+</span> <span class="s2">"\"</span><span class="na">+ApplicationName</span><span class="o">+</span><span class="s2">"_v"</span> <span class="o">+</span> <span class="kd">ApplicationVersion</span>
#define <span class="kd">PathOutput</span> <span class="kd">SourcePath</span> <span class="o">+</span> <span class="s2">"releases\v"</span> <span class="o">+</span> <span class="kd">ApplicationVersion</span> <span class="o">+</span> <span class="s2">"\"</span>
#define <span class="kd">PathAssets</span> <span class="kd">SourcePath</span> <span class="o">+</span> <span class="s2">"..\assets"</span>

<span class="o">;</span> <span class="kd">NOTE</span>: <span class="kd">The</span> <span class="kd">value</span> <span class="kd">of</span> <span class="kd">AppId</span> <span class="kd">uniquely</span> <span class="kd">identifies</span> <span class="kd">this</span> <span class="kd">application</span>.
<span class="o">;</span> <span class="kd">Do</span> <span class="ow">not</span> <span class="kd">use</span> <span class="kd">the</span> <span class="kd">same</span> <span class="kd">AppId</span> <span class="kd">value</span> <span class="k">in</span> <span class="kd">installers</span> <span class="k">for</span> <span class="kd">other</span> <span class="kd">applications</span>.
<span class="o">;</span> <span class="o">(</span><span class="kd">To</span> <span class="kd">generate</span> <span class="kd">a</span> <span class="kd">new</span> <span class="kd">GUID</span><span class="o">,</span> <span class="kd">click</span> <span class="kd">Tools</span> <span class="o">|</span> <span class="kd">Generate</span> <span class="kd">GUID</span> <span class="kd">inside</span> <span class="kd">the</span> <span class="kd">IDE</span>.<span class="o">)</span>
#define <span class="kd">ApplicationGUID</span> <span class="s2">"6886E28B-AAB5-4866-BCD5-E1B4C171A87A"</span>
#define <span class="kd">ApplicationID</span> <span class="kd">ApplicationName</span> <span class="o">+</span> <span class="s2">"_"</span> <span class="o">+</span> <span class="kd">ApplicationGUID</span>

<span class="o">[</span><span class="kd">Setup</span><span class="o">]</span>
<span class="o">;</span> <span class="kd">NOTE</span>: <span class="kd">The</span> <span class="kd">value</span> <span class="kd">of</span> <span class="kd">AppId</span> <span class="kd">uniquely</span> <span class="kd">identifies</span> <span class="kd">this</span> <span class="kd">application</span>.
<span class="o">;</span> <span class="kd">Do</span> <span class="ow">not</span> <span class="kd">use</span> <span class="kd">the</span> <span class="kd">same</span> <span class="kd">AppId</span> <span class="kd">value</span> <span class="k">in</span> <span class="kd">installers</span> <span class="k">for</span> <span class="kd">other</span> <span class="kd">applications</span>.
<span class="o">;</span> <span class="o">(</span><span class="kd">To</span> <span class="kd">generate</span> <span class="kd">a</span> <span class="kd">new</span> <span class="kd">GUID</span><span class="o">,</span> <span class="kd">click</span> <span class="kd">Tools</span> <span class="o">|</span> <span class="kd">Generate</span> <span class="kd">GUID</span> <span class="kd">inside</span> <span class="kd">the</span> <span class="kd">IDE</span>.<span class="o">)</span>
<span class="kd">AppId</span><span class="o">={</span>#ApplicationID<span class="o">}</span>
<span class="kd">AppName</span><span class="o">={</span>#ApplicationName<span class="o">}</span>
<span class="kd">AppVersion</span><span class="o">={</span>#ApplicationVersion<span class="o">}</span>
<span class="kd">AppPublisher</span><span class="o">={</span>#ApplicationPublisher<span class="o">}</span>
<span class="kd">AppPublisherURL</span><span class="o">={</span>#ApplicationURL<span class="o">}</span>
<span class="kd">AppSupportURL</span><span class="o">={</span>#ApplicationURL<span class="o">}</span>
<span class="kd">AppUpdatesURL</span><span class="o">={</span>#ApplicationURL<span class="o">}</span>
<span class="kd">AppCopyright</span><span class="o">={</span>#ApplicationCopyright<span class="o">}</span>
<span class="kd">DefaultDirName</span><span class="o">={</span><span class="kd">sd</span><span class="o">}</span>\ACME\<span class="o">{</span>#ApplicationName<span class="o">}</span>
<span class="kd">DefaultGroupName</span><span class="o">=</span><span class="kd">ACME</span>\<span class="o">{</span>#ApplicationName<span class="o">}</span>
<span class="kd">LicenseFile</span><span class="o">={</span>#PathAssets<span class="o">}</span>\LICENSE.txt
<span class="kd">InfoBeforeFile</span><span class="o">={</span>#PathAssets<span class="o">}</span>\BEFORE_INSTALL.txt
<span class="kd">InfoAfterFile</span><span class="o">={</span>#PathAssets<span class="o">}</span>\AFTER_INSTALL.txt
<span class="kd">OutputDir</span><span class="o">={</span>#PathOutput<span class="o">}</span>\
<span class="kd">OutputBaseFilename</span><span class="o">=</span><span class="kd">Setup_</span><span class="o">{</span>#ApplicationName<span class="o">}</span>_v<span class="o">{</span>#ApplicationVersion<span class="o">}</span>
<span class="kd">Compression</span><span class="o">=</span><span class="kd">lzma2</span><span class="na">/fast
</span><span class="kd">SolidCompression</span><span class="o">=</span><span class="kd">yes</span>
<span class="kd">AppContact</span><span class="o">=</span><span class="m">7567933</span><span class="na">+v</span><span class="m">20100</span><span class="kd">v</span>@users.noreply.github.com
<span class="kd">UninstallDisplayIcon</span><span class="o">={</span><span class="kd">app</span><span class="o">}</span>\assets\images\myApplication.ico
<span class="kd">WizardImageFile</span><span class="o">={</span>#PathAssets<span class="o">}</span>\images\innosetup_background.bmp
<span class="kd">WizardImageStretch</span><span class="o">=</span><span class="kd">no</span>
<span class="kd">WizardSmallImageFile</span><span class="o">={</span>#PathAssets<span class="o">}</span>\images\innosetup_image.bmp
<span class="kd">SetupIconFile</span><span class="o">={</span>#PathAssets<span class="o">}</span>\images\setup.ico
<span class="kd">BackColor</span><span class="o">=</span>$FFFF00
<span class="kd">VersionInfoVersion</span><span class="o">={</span>#ApplicationVersion<span class="o">}</span>

<span class="o">;</span> <span class="kd">Make</span> <span class="kd">this</span> <span class="kd">setup</span> <span class="kd">program</span> <span class="kd">work</span> <span class="kd">with</span> <span class="m">32</span><span class="na">-bit </span><span class="kd">and</span> <span class="m">64</span><span class="na">-bit </span><span class="kd">Windows</span>
<span class="kd">ArchitecturesAllowed</span><span class="o">=</span><span class="kd">x86</span> <span class="kd">x64</span>
<span class="kd">ArchitecturesInstallIn64BitMode</span><span class="o">=</span><span class="kd">x64</span>


<span class="o">[</span><span class="kd">Languages</span><span class="o">]</span>
<span class="kd">Name</span>: <span class="s2">"en"</span><span class="o">;</span> <span class="kd">MessagesFile</span>: <span class="kd">compiler</span><span class="nl">:Default</span>.isl<span class="o">;</span>
<span class="kd">Name</span>: <span class="s2">"french"</span><span class="o">;</span> <span class="kd">MessagesFile</span>: <span class="s2">"compiler:Languages\French.isl"</span>

<span class="o">[</span><span class="kd">CustomMessages</span><span class="o">]</span>
<span class="kd">french</span>.CheckInstall<span class="o">=</span><span class="kd">est</span> <span class="kd">d</span>√©j√† <span class="kd">install</span>√© <span class="kd">sur</span> <span class="kd">ce</span> <span class="kd">PC</span>.
<span class="kd">french</span>.CheckInstallAction<span class="o">=</span><span class="kd">Souhaitez</span><span class="na">-vous </span><span class="kd">d</span>√©sinstaller <span class="kd">cette</span> <span class="kd">version</span> <span class="kd">existante</span> <span class="kd">avant</span> <span class="kd">de</span> <span class="kd">poursuivre</span><span class="o">?</span>
<span class="kd">en</span>.CheckInstall<span class="o">=</span><span class="kd">is</span> <span class="kd">already</span> <span class="kd">install</span> <span class="na">on</span> <span class="kd">this</span> <span class="kd">PC</span>.
<span class="kd">en</span>.CheckInstallAction<span class="o">=</span><span class="kd">Do</span> <span class="kd">you</span> <span class="kd">want</span> <span class="kd">to</span> <span class="kd">uninstall</span> <span class="kd">this</span> <span class="kd">existing</span> <span class="kd">version</span> <span class="kd">before</span> <span class="kd">continuing</span><span class="o">?</span>

<span class="o">[</span><span class="kd">Tasks</span><span class="o">]</span>
<span class="kd">Name</span>: <span class="s2">"desktopicon"</span><span class="o">;</span> <span class="kd">Description</span>: <span class="s2">"{cm:CreateDesktopIcon}"</span><span class="o">;</span> <span class="kd">GroupDescription</span>: <span class="s2">"{cm:AdditionalIcons}"</span><span class="o">;</span>

<span class="o">[</span><span class="kd">Files</span><span class="o">]</span>
<span class="kd">Source</span>: <span class="s2">"{#PathRelease}\{#ApplicationExeName}"</span><span class="o">;</span> <span class="kd">DestDir</span>: <span class="s2">"{app}"</span><span class="o">;</span> <span class="kd">Flags</span>: <span class="kd">ignoreversion</span>
<span class="kd">Source</span>: <span class="s2">"{#PathRelease}\*"</span><span class="o">;</span> <span class="kd">DestDir</span>: <span class="s2">"{app}"</span><span class="o">;</span> <span class="kd">Flags</span>: <span class="kd">ignoreversion</span> <span class="kd">recursesubdirs</span> <span class="kd">createallsubdirs</span>
                                                                          
<span class="o">[</span><span class="kd">Icons</span><span class="o">]</span>
<span class="kd">Name</span>: <span class="s2">"{group}\{#ApplicationName}"</span><span class="o">;</span> <span class="kd">Filename</span>: <span class="s2">"{app}\{#ApplicationExeName}"</span><span class="o">;</span> <span class="kd">IconFilename</span>: <span class="o">{</span><span class="kd">app</span><span class="o">}</span>\assets\images\myApplication.ico<span class="o">;</span>
<span class="kd">Name</span>: <span class="s2">"{group}\{cm:ProgramOnTheWeb,{#ApplicationName}}"</span><span class="o">;</span> <span class="kd">Filename</span>: <span class="s2">"{#ApplicationURL}"</span><span class="o">;</span>
<span class="kd">Name</span>: <span class="s2">"{group}\{cm:UninstallProgram,{#ApplicationName}}"</span><span class="o">;</span> <span class="kd">Filename</span>: <span class="s2">"{uninstallexe}"</span><span class="o">;</span> <span class="kd">IconFilename</span>: <span class="o">{</span><span class="kd">app</span><span class="o">}</span>\assets\images\setup.ico<span class="o">;</span>
<span class="kd">Name</span>: <span class="s2">"{commondesktop}\{#ApplicationName}"</span><span class="o">;</span> <span class="kd">Filename</span>: <span class="s2">"{app}\{#ApplicationExeName}"</span><span class="o">;</span> <span class="kd">IconFilename</span>: <span class="o">{</span><span class="kd">app</span><span class="o">}</span>\assets\images\myApplication.ico<span class="o">;</span> <span class="kd">IconIndex</span>: <span class="m">0</span> 

<span class="o">[</span><span class="kd">Run</span><span class="o">]</span>
<span class="kd">Filename</span>: <span class="s2">"{app}\{#ApplicationExeName}"</span><span class="o">;</span> <span class="kd">Description</span>: <span class="s2">"{cm:LaunchProgram,{#StringChange(ApplicationName, '&amp;', '&amp;&amp;')}}"</span><span class="o">;</span> <span class="kd">Flags</span>: <span class="kd">shellexec</span> <span class="kd">postinstall</span> <span class="kd">skipifsilent</span>

<span class="o">[</span><span class="kd">Registry</span><span class="o">]</span>
<span class="kd">Root</span>: <span class="kd">HKCR</span><span class="o">;</span> <span class="kd">Subkey</span>: <span class="o">{</span>#ApplicationName<span class="o">}</span><span class="kd">Application</span><span class="o">;</span> <span class="kd">ValueType</span>: <span class="kd">string</span><span class="o">;</span> <span class="kd">ValueName</span>: <span class="o">;</span> <span class="kd">ValueData</span>: <span class="kd">Program</span> <span class="o">{</span>#ApplicationName<span class="o">};</span> <span class="kd">Flags</span>: <span class="kd">uninsdeletekey</span>
<span class="kd">Root</span>: <span class="kd">HKCR</span><span class="o">;</span> <span class="kd">Subkey</span>: <span class="o">{</span>#ApplicationName<span class="o">}</span><span class="kd">Application</span>\DefaultIcon<span class="o">;</span> <span class="kd">ValueType</span>: <span class="kd">string</span><span class="o">;</span> <span class="kd">ValueName</span>: <span class="o">;</span> <span class="kd">ValueData</span>: <span class="o">{</span><span class="kd">app</span><span class="o">}</span>\<span class="o">{</span>#ApplicationExeName<span class="o">},</span><span class="m">0</span><span class="o">;</span> <span class="kd">Flags</span>: <span class="kd">uninsdeletevalue</span>
<span class="kd">Root</span>: <span class="kd">HKCR</span><span class="o">;</span> <span class="kd">Subkey</span>: <span class="o">{</span>#ApplicationName<span class="o">}</span><span class="kd">Application</span>\shell\open\command<span class="o">;</span> <span class="kd">ValueType</span>: <span class="kd">string</span><span class="o">;</span> <span class="kd">ValueName</span>: <span class="o">;</span> <span class="kd">ValueData</span>: <span class="s2">"""{app}\{#ApplicationExeName}"" ""</span><span class="err">%</span><span class="s2">1"""</span><span class="o">;</span> <span class="kd">Flags</span>: <span class="kd">uninsdeletevalue</span>

<span class="o">[</span><span class="kd">Code</span><span class="o">]</span>
<span class="kd">function</span> <span class="kd">InitializeSetup</span><span class="o">()</span>: <span class="kd">Boolean</span><span class="o">;</span>
<span class="kd">var</span>
  <span class="kd">ResultCode</span>: <span class="kd">Integer</span><span class="o">;</span>
  <span class="kd">ResultStr</span><span class="nl">:string</span><span class="o">;</span>
<span class="kd">begin</span>
  // <span class="kd">Check</span> <span class="k">if</span> <span class="kd">the</span> <span class="kd">application</span> <span class="kd">is</span> <span class="kd">already</span> <span class="kd">install</span>
  // <span class="kd">MsgBox</span><span class="o">(</span><span class="s1">'ApplicationID = '</span> <span class="o">+</span> <span class="s1">'{#ApplicationID}'</span><span class="o">,</span> <span class="kd">mbInformation</span><span class="o">,</span> <span class="kd">mb_Ok</span><span class="o">);</span>
  <span class="kd">begin</span>
    <span class="kd">If</span> <span class="kd">RegQueryStringValue</span><span class="o">(</span><span class="kd">HKLM</span><span class="o">,</span> <span class="s1">'SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\{#ApplicationID}_is1'</span><span class="o">,</span> <span class="s1">'UninstallString'</span><span class="o">,</span> <span class="kd">ResultStr</span><span class="o">)</span> <span class="kd">then</span> <span class="kd">begin</span>
      <span class="kd">If</span> <span class="kd">ResultStr</span><span class="o">&lt;&gt;</span><span class="s1">''</span> <span class="kd">then</span> <span class="kd">begin</span>
        <span class="kd">ResultStr</span>:<span class="o">=</span><span class="kd">RemoveQuotes</span><span class="o">(</span><span class="kd">ResultStr</span><span class="o">);</span>
          <span class="k">if</span> <span class="kd">MsgBox</span><span class="o">(</span><span class="s1">'{#ApplicationName} '</span> <span class="o">+</span> <span class="kd">ExpandConstant</span><span class="o">(</span><span class="s1">'{cm:CheckInstall}'</span><span class="o">)</span> <span class="o">+</span> #13#13 <span class="o">+</span> <span class="kd">ExpandConstant</span><span class="o">(</span><span class="s1">'{cm:CheckInstallAction}'</span><span class="o">),</span> <span class="kd">mbConfirmation</span><span class="o">,</span> <span class="kd">MB_YESNO</span><span class="o">)</span> <span class="o">=</span> <span class="kd">idYes</span> <span class="kd">then</span>
          <span class="k">if</span> <span class="ow">not</span> <span class="kd">Exec</span><span class="o">(</span><span class="kd">ResultStr</span><span class="o">,</span> <span class="s1">'/silent'</span><span class="o">,</span> <span class="s1">''</span><span class="o">,</span> <span class="kd">SW_SHOW</span><span class="o">,</span> <span class="kd">ewWaitUntilTerminated</span><span class="o">,</span> <span class="kd">ResultCode</span><span class="o">)</span> <span class="kd">then</span>
            <span class="kd">MsgBox</span><span class="o">(</span><span class="s1">'Erreur </span><span class="err">!!!</span><span class="s1"> '</span> #13#13 <span class="s1">''</span> <span class="o">+</span> <span class="kd">SysErrorMessage</span><span class="o">(</span><span class="kd">ResultCode</span><span class="o">)</span> <span class="o">+</span> <span class="s1">'.'</span><span class="o">,</span> <span class="kd">mbError</span><span class="o">,</span> <span class="kd">MB_OK</span><span class="o">);</span>
      <span class="kd">end</span><span class="o">;</span>
    <span class="kd">end</span><span class="o">;</span>
  <span class="kd">end</span> <span class="o">;</span>
  <span class="kd">Result</span> :<span class="o">=</span> <span class="kd">True</span><span class="o">;</span>
<span class="kd">end</span><span class="o">;</span>

<span class="kd">procedure</span> <span class="kd">InitializeWizard</span><span class="o">();</span>
<span class="kd">var</span>
  <span class="kd">WLabel1</span><span class="o">,</span> <span class="kd">WLabel2</span> : <span class="kd">TLabel</span><span class="o">;</span>
<span class="kd">begin</span>
  <span class="kd">WizardForm</span>.WelcomeLabel1.Hide<span class="o">;</span>
  <span class="kd">WizardForm</span>.WelcomeLabel2.Hide<span class="o">;</span>
  <span class="kd">WizardForm</span>.FinishedHeadingLabel.Hide<span class="o">;</span>

  <span class="kd">WizardForm</span>.WizardBitmapImage.Width :<span class="o">=</span> <span class="m">500</span><span class="o">;</span>
  <span class="kd">WizardForm</span>.WizardBitmapImage.Height :<span class="o">=</span> <span class="m">315</span><span class="o">;</span>

  <span class="kd">WLabel1</span> :<span class="o">=</span> <span class="kd">TLabel</span>.Create<span class="o">(</span><span class="kd">WizardForm</span><span class="o">);</span>
  <span class="kd">WLabel1</span>.Left :<span class="o">=</span> <span class="kd">ScaleX</span><span class="o">(</span><span class="m">176</span><span class="o">);</span> 
  <span class="kd">WLabel1</span>.Top :<span class="o">=</span> <span class="kd">ScaleY</span><span class="o">(</span><span class="m">16</span><span class="o">);</span>
  <span class="kd">WLabel1</span>.Width :<span class="o">=</span> <span class="kd">ScaleX</span><span class="o">(</span><span class="m">301</span><span class="o">);</span> 
  <span class="kd">WLabel1</span>.Height :<span class="o">=</span> <span class="kd">ScaleY</span><span class="o">(</span><span class="m">54</span><span class="o">);</span> 
  <span class="kd">WLabel1</span>.AutoSize :<span class="o">=</span> <span class="kd">False</span><span class="o">;</span>
  <span class="kd">WLabel1</span>.WordWrap :<span class="o">=</span> <span class="kd">True</span><span class="o">;</span>
  <span class="kd">WLabel1</span>.Font.Name :<span class="o">=</span> <span class="s1">'tahoma'</span><span class="o">;</span> 
  <span class="kd">WLabel1</span>.Font.Size :<span class="o">=</span> <span class="m">12</span><span class="o">;</span> 
  <span class="kd">WLabel1</span>.Font.Style :<span class="o">=</span> <span class="o">[</span><span class="kd">fsBold</span><span class="o">];</span>
  <span class="kd">WLabel1</span>.Font.Color:<span class="o">=</span> <span class="kd">clBlack</span><span class="o">;</span> 
  <span class="kd">WLabel1</span>.ShowAccelChar :<span class="o">=</span> <span class="kd">False</span><span class="o">;</span>
  <span class="kd">WLabel1</span>.Caption :<span class="o">=</span> <span class="kd">WizardForm</span>.WelcomeLabel1.Caption<span class="o">;</span>
  <span class="kd">WLabel1</span>.Transparent :<span class="o">=</span> <span class="kd">True</span><span class="o">;</span>
  <span class="kd">WLabel1</span>.Parent :<span class="o">=</span> <span class="kd">WizardForm</span>.WelcomePage<span class="o">;</span>
  <span class="kd">WLabel1</span>.Hide<span class="o">;</span>

  <span class="kd">WLabel2</span> :<span class="o">=</span><span class="kd">TLabel</span>.Create<span class="o">(</span><span class="kd">WizardForm</span><span class="o">);</span>
  <span class="kd">WLabel2</span>.Left :<span class="o">=</span> <span class="kd">ScaleX</span><span class="o">(</span><span class="m">176</span><span class="o">);</span> 
  <span class="kd">WLabel2</span>.Top :<span class="o">=</span> <span class="kd">ScaleY</span><span class="o">(</span><span class="m">136</span><span class="o">);</span>
  <span class="kd">WLabel2</span>.Width :<span class="o">=</span> <span class="kd">ScaleX</span><span class="o">(</span><span class="m">301</span><span class="o">);</span> 
  <span class="kd">WLabel2</span>.Height :<span class="o">=</span> <span class="kd">ScaleY</span><span class="o">(</span><span class="m">234</span><span class="o">);</span> 
  <span class="kd">WLabel2</span>.AutoSize :<span class="o">=</span> <span class="kd">False</span><span class="o">;</span>
  <span class="kd">WLabel2</span>.WordWrap :<span class="o">=</span> <span class="kd">True</span><span class="o">;</span>
  <span class="kd">WLabel2</span>.Font.Name :<span class="o">=</span> <span class="s1">'tahoma'</span><span class="o">;</span> 
  <span class="kd">WLabel2</span>.Font.Color:<span class="o">=</span> <span class="kd">clBlack</span><span class="o">;</span> 
  <span class="kd">WLabel2</span>.ShowAccelChar :<span class="o">=</span> <span class="kd">False</span><span class="o">;</span>
  <span class="kd">WLabel2</span>.Caption :<span class="o">=</span> <span class="kd">WizardForm</span>.WelcomeLabel2.Caption<span class="o">;</span>
  <span class="kd">WLabel2</span>.Transparent :<span class="o">=</span> <span class="kd">True</span><span class="o">;</span>
  <span class="kd">WLabel2</span>.Parent :<span class="o">=</span> <span class="kd">WizardForm</span>.WelcomePage<span class="o">;</span>

  <span class="kd">WizardForm</span>.WizardBitmapImage2.Width :<span class="o">=</span> <span class="m">500</span><span class="o">;</span> 
  <span class="kd">WizardForm</span>.WizardBitmapImage2.Height :<span class="o">=</span> <span class="m">315</span><span class="o">;</span> 

  <span class="kd">WizardForm</span>.FinishedLabel.Left :<span class="o">=</span> <span class="kd">ScaleX</span><span class="o">(</span><span class="m">176</span><span class="o">);</span>
  <span class="kd">WizardForm</span>.FinishedLabel.Top :<span class="o">=</span> <span class="kd">ScaleY</span><span class="o">(</span><span class="m">116</span><span class="o">);</span>
<span class="kd">end</span><span class="o">;</span>

<span class="kd">procedure</span> <span class="kd">CurPageChanged</span><span class="o">(</span><span class="kd">CurPageID</span>: <span class="kd">Integer</span><span class="o">);</span>
<span class="kd">begin</span>
  // <span class="kd">you</span> <span class="kd">must</span> <span class="k">do</span> <span class="kd">this</span> <span class="kd">as</span> <span class="kd">late</span> <span class="kd">as</span> <span class="kd">possible</span><span class="o">,</span> <span class="kd">because</span> <span class="kd">the</span> <span class="kd">RunList</span> <span class="kd">is</span> <span class="kd">being</span> <span class="kd">modified</span>
  // <span class="kd">after</span> <span class="kd">installation</span><span class="o">;</span> <span class="kd">so</span> <span class="kd">this</span> <span class="kd">will</span> <span class="kd">check</span> <span class="k">if</span> <span class="kd">there</span><span class="s1">'s at least one item in the
  // RunList and then set to the first item (indexing starts at 0) Enabled state
  // to False
  if (CurPageID = wpFinished) then    
    //WizardForm.RunList.Visible := False;
    WizardForm.RunList.Left := ScaleX(176);
    WizardForm.RunList.Top := ScaleY(214);
end;
</span></code></pre></div></div>

<p><br /></p>

<blockquote>
  <p><strong>Lectures associ√©s</strong></p>

  <p><a href="https://autoit-gui-skeleton.github.io//fr/documentation/getting-started">1. D√©marrer avec AGS</a></p>
</blockquote>

:ET